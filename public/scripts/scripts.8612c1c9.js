!function(a){"use strict";function b(a){return new RegExp("(^|\\s+)"+a+"(\\s+|$)")}function c(a,b){var c=d(a,b)?f:e;c(a,b)}var d,e,f;"classList"in document.documentElement?(d=function(a,b){return null==a?!1:a.classList.contains(b)},e=function(a,b){return null==a?!1:void a.classList.add(b)},f=function(a,b){return null==a?!1:void a.classList.remove(b)}):(d=function(a,c){return b(c).test(a.className)},e=function(a,b){d(a,b)||(a.className=a.className+" "+b)},f=function(a,c){a.className=a.className.replace(b(c)," ")});var g={hasClass:d,addClass:e,removeClass:f,toggleClass:c,has:d,add:e,remove:f,toggle:c};"function"==typeof define&&define.amd?define(g):"object"==typeof exports?module.exports=g:a.classie=g}(window),function(){var a,b,c,d,e=function(a,b){return function(){return a.apply(b,arguments)}},f=[].indexOf||function(a){for(var b=0,c=this.length;c>b;b++)if(b in this&&this[b]===a)return b;return-1};jQuery.fn.extend({imagepicker:function(b){return null==b&&(b={}),this.each(function(){var c;return c=jQuery(this),c.data("picker")&&c.data("picker").destroy(),c.data("picker",new a(this,d(b))),null!=b.initialized?b.initialized.call(c.data("picker")):void 0})}}),d=function(a){var b;return b={hide_select:!0,show_label:!1,initialized:void 0,changed:void 0,clicked:void 0,selected:void 0,limit:void 0,limit_reached:void 0},jQuery.extend(b,a)},c=function(a,b){return 0===jQuery(a).not(b).length&&0===jQuery(b).not(a).length},a=function(){function a(a,b){this.opts=null!=b?b:{},this.sync_picker_with_select=e(this.sync_picker_with_select,this),this.select=jQuery(a),this.multiple="multiple"===this.select.attr("multiple"),null!=this.select.data("limit")&&(this.opts.limit=parseInt(this.select.data("limit"))),this.build_and_append_picker()}return a.prototype.destroy=function(){var a,b,c,d;for(d=this.picker_options,b=0,c=d.length;c>b;b++)a=d[b],a.destroy();return this.picker.remove(),this.select.unbind("change"),this.select.removeData("picker"),this.select.show()},a.prototype.build_and_append_picker=function(){var a=this;return this.opts.hide_select&&this.select.hide(),this.select.change(function(){return a.sync_picker_with_select()}),null!=this.picker&&this.picker.remove(),this.create_picker(),this.select.after(this.picker),this.sync_picker_with_select()},a.prototype.sync_picker_with_select=function(){var a,b,c,d,e;for(d=this.picker_options,e=[],b=0,c=d.length;c>b;b++)a=d[b],a.is_selected()?e.push(a.mark_as_selected()):e.push(a.unmark_as_selected());return e},a.prototype.create_picker=function(){return this.picker=jQuery("<ul class='thumbnails image_picker_selector'></ul>"),this.picker_options=[],this.recursively_parse_option_groups(this.select,this.picker),this.picker},a.prototype.recursively_parse_option_groups=function(a,c){var d,e,f,g,h,i,j,k,l,m;for(k=a.children("optgroup"),g=0,i=k.length;i>g;g++)f=k[g],f=jQuery(f),d=jQuery("<ul></ul>"),d.append(jQuery("<li class='group_title'>"+f.attr("label")+"</li>")),c.append(jQuery("<li>").append(d)),this.recursively_parse_option_groups(f,d);for(l=function(){var c,d,f,g;for(f=a.children("option"),g=[],c=0,d=f.length;d>c;c++)e=f[c],g.push(new b(e,this,this.opts));return g}.call(this),m=[],h=0,j=l.length;j>h;h++)e=l[h],this.picker_options.push(e),e.has_image()&&m.push(c.append(e.node));return m},a.prototype.has_implicit_blanks=function(){var a;return function(){var b,c,d,e;for(d=this.picker_options,e=[],b=0,c=d.length;c>b;b++)a=d[b],a.is_blank()&&!a.has_image()&&e.push(a);return e}.call(this).length>0},a.prototype.selected_values=function(){return this.multiple?this.select.val()||[]:[this.select.val()]},a.prototype.toggle=function(a){var b,d,e;return d=this.selected_values(),e=a.value().toString(),this.multiple?f.call(this.selected_values(),e)>=0?(b=this.selected_values(),b.splice(jQuery.inArray(e,d),1),this.select.val([]),this.select.val(b)):null!=this.opts.limit&&this.selected_values().length>=this.opts.limit?null!=this.opts.limit_reached&&this.opts.limit_reached.call(this.select):this.select.val(this.selected_values().concat(e)):this.has_implicit_blanks()&&a.is_selected()?this.select.val(""):this.select.val(e),c(d,this.selected_values())||(this.select.change(),null==this.opts.changed)?void 0:this.opts.changed.call(this.select,d,this.selected_values())},a}(),b=function(){function a(a,b,c){this.picker=b,this.opts=null!=c?c:{},this.clicked=e(this.clicked,this),this.option=jQuery(a),this.create_node()}return a.prototype.destroy=function(){return this.node.find(".thumbnail").unbind()},a.prototype.has_image=function(){return null!=this.option.data("img-src")},a.prototype.is_blank=function(){return!(null!=this.value()&&""!==this.value())},a.prototype.is_selected=function(){var a;return a=this.picker.select.val(),this.picker.multiple?jQuery.inArray(this.value(),a)>=0:this.value()===a},a.prototype.mark_as_selected=function(){return this.node.find(".thumbnail").addClass("selected")},a.prototype.unmark_as_selected=function(){return this.node.find(".thumbnail").removeClass("selected")},a.prototype.value=function(){return this.option.val()},a.prototype.label=function(){return this.option.data("img-label")?this.option.data("img-label"):this.option.text()},a.prototype.clicked=function(){return this.picker.toggle(this),null!=this.opts.clicked&&this.opts.clicked.call(this.picker.select,this),null!=this.opts.selected&&this.is_selected()?this.opts.selected.call(this.picker.select,this):void 0},a.prototype.create_node=function(){var a,b;return this.node=jQuery("<li/>"),a=jQuery("<img class='image_picker_image'/>"),a.attr("src",this.option.data("img-src")),b=jQuery("<div class='thumbnail'>"),b.click({option:this},function(a){return a.data.option.clicked()}),b.append(a),this.opts.show_label&&b.append(jQuery("<p/>").html(this.label())),this.node.append(b),this.node},a}()}.call(this),angular.module("config",[]).constant("api_host","http://dev-winwins.net").constant("e_host","http://search.dev-winwins.net").value("debug",!0),angular.module("winwinsApp",["ngAnimate","ngCookies","ngResource","ngMessages","ngFileUpload","ngSanitize","ngTouch","ngTagsInput","ui.router","ui.select","ui.bootstrap","satellizer","config","infinite-scroll","zumba.angular-waypoints","pascalprecht.translate","headroom","720kb.socialshare","truncate","angular-loading-bar","frapontillo.bootstrap-switch"]).config(["$locationProvider","$stateProvider","$urlRouterProvider",function(a,b,c){function d(a,b,c,d){var e=a.defer();return c.isAuthenticated()?e.resolve():(console.dir(d),b.path("/signin")),e.promise}c.otherwise("/"),b.state("main",{url:"/",templateUrl:"views/main.html",controller:"MainCtrl"}).state("signUp",{url:"/signup",templateUrl:"views/signup.html",controller:"SignUpCtrl"}).state("logout",{url:"/logout",template:null,controller:"LogoutCtrl"}).state("profile",{url:"/profile",templateUrl:"views/user/profile.html",controller:"ProfileCtrl"}).state("profile_notificaciones",{url:"/notificaciones",templateUrl:"views/user/user_notificaciones.html",controller:"ProfileNotificaciones"}).state("cancel-account",{url:"/cancel-account",templateUrl:"views/user/cancel_account.html",controller:"cancel-account"}).state("account",{url:"/account",templateUrl:"views/user/account.html",controller:"MainCtrl"}).state("winwin",{url:"/winwin",templateUrl:"views/winwin.html",controller:"WinwinCtrl"}).state("winwin-new",{url:"/winwin-new",templateUrl:"views/winwin/edit.html",controller:"winwin-edit",resolve:{loginRequired:d}}).state("winwin-first-post",{url:"/winwin-first-post/:winwinId",templateUrl:"views/winwin/first_post.html",controller:"winwin-first-post"}).state("winwin-promote",{url:"/winwin-promote/:winwinId",templateUrl:"views/winwin/promote.html",controller:"winwin-promote"}).state("winwin-list",{url:"/winwin-list",templateUrl:"views/winwin/list.html",controller:"winwin-list"}).state("winwin-search",{url:"/winwin-search",templateUrl:"views/winwin/search.html",controller:"winwin-search"}).state("winwin-view",{url:"/winwin-view/:winwinId?actionJoin",templateUrl:"views/winwin-tabs/view.html",controller:"winwin-tabs"}).state("winwin-left",{templateUrl:"views/winwin-tabs/ww-left.html",url:"/winwin-left/:winwinId",controller:"winwin-left"}).state("winwin-joined",{templateUrl:"views/winwin-tabs/ww-joined.html",url:"/winwin-joined/:winwinId",controller:"winwin-joined"}).state("winwin-sponsored",{templateUrl:"views/winwin-tabs/ww-sponsored.html",url:"/winwin-sponsored/:winwinId",controller:"winwin-sponsored"}).state("group-sponsored",{templateUrl:"views/group/group-sponsored.html",url:"/group-sponsored/:groupId",controller:"group-sponsored"}).state("winwin-muro",{templateUrl:"views/winwin-view/ww-wall.html",url:"/winwin-view/:winwinId",controller:"winwin-muro"}).state("winwin-members",{templateUrl:"views/winwin-view/ww-users.html",url:"/winwin-view/:winwinId",controller:"winwin-members"}).state("winwin-sponsors",{templateUrl:"views/winwin-view/ww-sponsors.html",url:"/winwin-view/:winwinId",controller:"winwin-sponsors"}).state("admin_campanada",{templateUrl:"views/winwin-view/ww-campanada.html",url:"/winwin-view/:winwinId",controller:"winwin-campanada"}).state("winwin-view.admin_configuracion",{templateUrl:"views/winwin/admin_configuracion.html",controller:"winwin-configuracion"}).state("winwin-view.admin_patrocinio",{templateUrl:"views/winwin/admin_solicitud_patrocinio.html",controller:"winwin-patrocinio"}).state("winwin-view.admin_miembros",{templateUrl:"views/winwin/admin_participantes.html",controller:"winwin-miembros"}).state("winwin-view.winwin-sponsor-request",{templateUrl:"views/winwin/admin_solicitud_patrocinio.html",controller:"winwin-sponsor-request"}).state("createWW",{url:"/createww",templateUrl:"views/createWW.html",controller:"CreateWWCtrl"}).state("createWWid",{url:"/createwwid",templateUrl:"views/createWWid.html",controller:"CreateWWCtrl"}).state("signIn",{url:"/signin",templateUrl:"views/login.html",controller:"LoginCtrl"}).state("success-login",{url:"/success-login",templateUrl:"views/login_success.html",controller:"SuccessLogin"}).state("failure-login",{url:"/fail-login",templateUrl:"views/login_failure.html",controller:"FailureLogin"}).state("activateWW",{url:"/activate",templateUrl:"views/activateWW.html",controller:"ActivateWWCtrl"}).state("promote",{url:"/promote",templateUrl:"views/promote.html",controller:"ActivateWWCtrl"}).state("members",{url:"/members",templateUrl:"views/members.html",controller:"MembersCtrl"}).state("comments",{url:"/comments",templateUrl:"views/comments.html",controller:"WinwinCtrl"}).state("group-view",{url:"/group-view/:groupId",templateUrl:"views/group/view.html",controller:"group-view"}).state("group-new",{url:"/group-new",templateUrl:"views/group/edit.html",controller:"group-edit"}).state("group-promote",{url:"/group-promote/:groupId",templateUrl:"views/group/promote.html",controller:"group-promote"}).state("group-list",{url:"/group-list",templateUrl:"views/group/list.html",controller:"group-list"}).state("user-view",{url:"/user-view/:userId",templateUrl:"views/user/profile.html",controller:"user-view"}).state("user-list",{url:"/user-list",templateUrl:"views/user/list.html",controller:"user-list"}).state("sponsor-view",{url:"/sponsor-view/:sponsorId",templateUrl:"views/sponsor/view.html",controller:"sponsor-view"}).state("sponsor-signup",{url:"/sponsor-signup",templateUrl:"views/sponsor/signup.html",controller:"sponsor-signup"}).state("sponsor-new",{url:"/sponsor-new",templateUrl:"views/sponsor/signup.html",controller:"sponsor-signup"}).state("search-list",{url:"/search/:query",templateUrl:"views/search/list.html",controller:"search-list"}).state("sponsor-list",{url:"/sponsor-list",templateUrl:"views/sponsor/list.html",controller:"sponsor-list"}).state("terms",{url:"/site/terms",templateUrl:"views/site/terms.html"}).state("contact",{url:"/site/contact",templateUrl:"views/site/contact.html",controller:"contact-controller"}).state("how",{url:"/site/how",templateUrl:"views/site/how.html"}).state("about",{url:"/site/about",templateUrl:"views/site/about.html"}),d.$inject=["$q","$location","$auth","$state"]}]).config(["cfpLoadingBarProvider",function(a){a.includeSpinner=!1,a.includeBar=!0}]).config(["$authProvider","api_host",function(a,b){a.baseUrl=b+"/",a.httpInterceptor=!0,a.facebook({clientId:"1082199191794840",scope:"email,public_profile"}),a.google({clientId:"313110710680-p22p1s5brqn7tfaqj9v16u67bic5smqk.apps.googleusercontent.com"}),a.yahoo({clientId:"dj0yJmk9SDVkM2RhNWJSc2ZBJmQ9WVdrOWIzVlFRMWxzTXpZbWNHbzlNQS0tJnM9Y29uc3VtZXJzZWNyZXQmeD0yYw--"}),a.twitter({url:"/auth/twitter"})}]).config(["$translateProvider",function(a){a.useMissingTranslationHandlerLog(),a.useUrlLoader("/api/translation"),a.preferredLanguage("es_ES")}]).directive("ngEnter",function(){return function(a,b,c){b.bind("keydown keypress",function(b){13===b.which&&(a.$apply(function(){a.$eval(c.ngEnter)}),b.preventDefault())})}}).constant("LOCALES",{locales:{es_ES:"Español",en_US:"English"},preferredLocale:"es_ES"}).controller("Ctrl",["$scope","$location","$window",function(a,b,c){a.$on("$locationChangeStart",function(c,d,e){a.startPath=b.path(),a.startNewUrl=d,a.startOldUrl=e}),a.$on("$locationChangeSuccess",function(c,d,e){a.successPath=b.path(),a.successNewUrl=d,a.successOldUrl=e}),a.back=function(){c.history.back()},a.forward=function(){c.history.forward()}}]).directive("dynamicBackground",[function(){return{restrict:"A",link:function(a,b,c){a.setBg=function(){angular.element(b[0]).css({"background-color":c.backgroundColor,"background-repeat":c.backgroundRepeat,"background-position":c.backgroundPosition,"background-attachment":c.backgroundAttachment,"background-origin":c.backgroundOrigin,"background-clip":c.backgroundClip,background:"linear-gradient(rgba(0, 0, 0, 0.73), rgba(154, 148, 120, 0.0980392)),url("+c.backgroundImage+")","background-size":"cover"})},a.launchDynamicBg=function(){c.backgroundOnEvent?angular.element(b[0]).bind(c.backgroundOnEvent,function(){a.setBg()}):a.setBg()},angular.forEach(["backgroundImage","backgroundColor","backgroundSize","backgroundPosition","backgroundClip","backgroundAttachment","backgroundOnEvent","backgroundRepeat","backgroundOrigin","background"],function(b){c.$observe(b,function(b){b&&a.launchDynamicBg()})})}}}]).run(["$rootScope","$templateCache","$timeout",function(a,b,c){console.log("run"),c(function(){window.loading_screen.finish()},2e3),a.$on("$routeChangeStart",function(a,c,d){"undefined"!=typeof d&&b.remove(d.templateUrl)})}]),angular.module("winwinsApp").controller("MainCtrl",["$scope","$auth","$http","$state","$timeout","Winwin","api_host","$uibModal",function(a,b,c,d,e,f,g,h){a.winwins=[],a.main_sponsors=[],a.all_winwins=[],a.popSponsor=function(){return a.main_sponsors.length?a.main_sponsors.pop():!1},c.get(g+"/api/sponsors/main").success(function(b){a.main_sponsors=b,f.query(function(b){a.all_winwins=b,a.winwins=[];var c=0;_.each(a.all_winwins,function(b){c+=1,c%3==0&&a.winwins.push(_.extend(a.popSponsor(),{is_sponsor:!0})),a.winwins.push(_.extend(b,{is_sponsor:!1}))})})}),a.isAuthenticated=function(){return b.isAuthenticated()},a.goControlPanel=function(){d.go("account")},a.join=function(e){b.isAuthenticated()?c.get(g+"/api/winwins/join/"+e).success(function(b){swal({title:"info",text:"winwin_join",type:"info",showcancelbutton:!1,animation:!1,closeonconfirm:!0},function(){a.view(e)})}).error(function(a){swal({title:"ADVERTENCIA",text:a.message,type:"warning",showCancelButton:!1,animation:!1,closeOnConfirm:!0})}):d.go("signIn")},a.viewProfile=function(a){d.go("user-view",{userId:a})},a.viewSponsor=function(a){d.go("sponsor-view",{sponsorId:a})},a.view=function(a){console.log("view "+a),d.go("winwin-view",{winwinId:a})},a.openShare=function(a){$("#socialModal").modal("show"),console.log("winwin_id: "+a)},a.openSocialModal=function(b){a.toShare=b;h.open({animation:!1,windowTopClass:"modal-background",templateUrl:"myModalContent.html",controller:"ModalInstanceCtrl",resolve:{toShare:function(){return a.toShare}}})},a.filter=function(b){a.is_filtered="all"!==b,console.log(b),a.is_filtered?(console.log("filter"),a.winwins=_.filter(a.all_winwins,function(a){return a.mark==b})):a.winwins=a.all_winwins},a.visible_search=!1,a.showSearch=function(){a.visible_search=!0,jQuery("#slider").stop().animate({"margin-top":"0"})>10,console.log("visible search")}}]).controller("ModalInstanceCtrl",["$scope","$uibModalInstance","toShare",function(a,b,c){a.toShare=c}]).controller("main-search-controller",["$scope","$state",function(a,b){a.search=function(){console.log("query: "+a.term),b.go("search-list",{query:a.term,winwin:!0,user:!0,group:!0,sponsor:!0})}}]).controller("contact-controller",["$scope","$auth","$http","$state","api_host",function(a,b,c,d,e){}]),angular.module("winwinsApp").controller("SignUpCtrl",["$scope","$rootScope","$timeout","$state","$auth",function(a,b,c,d,e){a.show_signup=!0,a.redirect_message=!1,a.signup=function(){e.signup({username:a.name,email:a.email,password:a.password,birthdate:a.birthdate,name:a.name,lastname:a.lastname,language_code:"ES"}).then(function(f){e.login({email:a.email,password:a.password}).then(function(e){b.currentUser=e,b.$broadcast("is_logged",!0),a.show_signup=!1,a.redirect_message=!0,c(function(){if(b.returnState)switch(b.returnState.state){case"ww-join":d.go("winwin-view",{winwinId:b.returnState.parameters.winwinId,actionJoin:!0});break;default:d.go("main")}else d.go("main")},3e3)})})["catch"](function(a){swal({title:"ADVERTENCIA",text:"Error en su registracion",type:"warning",showCancelButton:!1,animation:!1,closeOnConfirm:!0}),d.go("signUp")})},a.authenticate=function(f){e.authenticate(f).then(function(e){b.currentUser=e,b.$broadcast("is_logged",!0),a.show_signup=!1,a.provider=f,a.redirect_message=!0,c(function(){if(b.returnState)switch(b.returnState.state){case"ww-join":d.go("winwin-view",{winwinId:b.returnState.parameters.winwinId,actionJoin:!0});break;default:d.go("main")}else d.go("main")},3e3)})["catch"](function(a){d.go("failure-login"),swal({title:"ADVERTENCIA",text:"Error en su autenticación",type:"warning",showCancelButton:!1,animation:!1,closeOnConfirm:!0})})}}]).controller("sponsor-signup",["$scope","$rootScope","$timeout","$state","$auth",function(a,b,c,d,e){a.show_signup=!0,a.redirect_message=!1,a.signup=function(){e.signup({username:a.name,email:a.email,password:a.password,birthdate:a.birthdate,name:a.name,is_sponsor:!0,sponsor_organization:a.sponsor_organization,lastname:a.lastname,language_code:"ES"}).then(function(f){e.login({email:a.email,password:a.password}).then(function(e){b.currentUser=e,b.$broadcast("is_logged",!0),a.show_signup=!1,a.redirect_message=!0,c(function(){d.go("main")},3e3)})})["catch"](function(a){swal({title:"ADVERTENCIA",text:"Error en su registracion",type:"warning",showCancelButton:!1,animation:!1,closeOnConfirm:!0}),d.go("signUp")})},a.authenticate=function(f){e.authenticate(f).then(function(e){b.currentUser=e,b.$broadcast("is_logged",!0),a.show_signup=!1,a.provider=f,a.redirect_message=!0,c(function(){if(b.returnState)switch(b.returnState.state){case"ww-join":d.go("winwin-view",{winwinId:b.returnState.parameters.winwinId,actionJoin:!0});break;default:d.go("main")}else d.go("main")},3e3)})["catch"](function(a){d.go("failure-login"),swal({title:"ADVERTENCIA",text:"Error en su autenticación",type:"warning",showCancelButton:!1,animation:!1,closeOnConfirm:!0})})}}]),angular.module("winwinsApp").controller("winwin-tabs",["$scope","$http","$state","$sce","$stateParams","$timeout","$anchorScroll","$location","$auth","$uibModal","$rootScope","Winwin","Account","api_host",function(a,b,c,d,e,f,g,h,i,j,k,l,m,n){a.is_admin=!1,a.current_view="home",a.setCurrentView=function(b){a.current_view=b,a.is_admin=!1},a.setNormal=function(){a.is_admin=!1},a.setAdmin=function(){console.log("is admin? "+a.isAdmin),a.isAdmin&&(a.is_admin=!0)},a.isAdmin=!1,a.winwin_view=!0,a.show_closing_date=!1,a.show_description=!1,a.show_details=function(b){a.show_description=b},a.posts=[],a.last={},a.getPosts=function(){b.get(n+"/api/posts/winwin/"+e.winwinId+"/posts").success(function(b){a.posts=b.posts,a.last=b.last})},a.winwin={},a.getWinwin=function(){a.winwin=l.get({id:e.winwinId},function(b){a.winwin=b,a.calculate_time(),a.winwin.is_moderator&&(a.isAdmin=!0),console.log(e.actionJoin),e.actionJoin&&a.join()})},a.isSponsor=!1,m.getProfile().success(function(b){b&&(a.account=b.account,a.profile=b.profile,a.sponsor=b.sponsor,a.isSponsor=b.is_sponsor)}),a.duration_days=0,a.duration_hours=0,a.duration_minutes=0,a.calculate_time=function(){var b=moment(),c=moment(a.winwin.closing_date);if(a.show_closing_date=!1,a.winwin.closing_date&&c.isAfter(b)){a.duration_days=c.diff(b,"days"),a.duration_hours=c.diff(b.add(a.duration_days,"days"),"hours");var d=c.diff(b.add(a.duration_days,"days").add(a.duration_hours,"hours"),"minutes");a.duration_minutes=0>d?0:d,a.show_closing_date=!0}else a.winwin.closing_date&&!c.isAfter(b)&&(a.is_finished=!0)},a.getWinwin(),a.viewProfile=function(a){c.go("user-view",{userId:a})},a.join=function(){i.isAuthenticated()?b.get(n+"/api/winwins/join/"+a.winwin.id).success(function(b){c.go("winwin-joined",{winwinId:a.winwin.id,winwinName:a.winwin.title})}).error(function(a){swal({title:"ADVERTENCIA",text:"Error al unirse.",type:"warning",showCancelButton:!1,closeOnConfirm:!0})}):(k.returnState={state:"ww-join",parameters:{winwinId:a.winwin.id}},c.go("signIn"))},a.pass=function(){c.go("winwin-list")},a.left=function(){b.get(n+"/api/winwins/left/"+a.winwin.id).success(function(b){c.go("winwin-left",{winwinId:a.winwin.id,winwinName:a.winwin.title})}).error(function(a){swal({title:"ADVERTENCIA",text:"Error al abandonar.",type:"warning",showCancelButton:!1,closeOnConfirm:!0})})},a.askForSponsored=function(){swal({title:"SOLICITAR PATROCINIO",text:"Envia un mensaje de solicitud al creador del Winwin",type:"input",showCancelButton:!0,closeOnConfirm:!0,inputPlaceholder:"Mensaje de solicitud"},function(d){return d===!1?!1:""===d?!1:(b.post(n+"/api/winwins/sponsor_request/"+a.winwin.id,{body:d}).success(function(b){c.go("winwin-sponsored",{winwinId:a.winwin.id,winwinName:a.winwin.title})}).error(function(a){swal({title:"Error",text:"Error en la peticion.",type:"warning",showCancelButton:!1,closeOnConfirm:!0})}),!0)})},a.getIframeSrc=function(a){return d.trustAsResourceUrl("https://www.youtube.com/embed/"+a+"?autoplay=1")},a.openMailModal=function(b){a.toShare=b;j.open({animation:!1,windowTopClass:"modal-background",templateUrl:"myMailShare.html",controller:"ModalMailCtrl",resolve:{toShare:function(){return a.toShare},mails:function(){return{}}}})}}]).controller("winwin-left",["$scope","$http","$state","$stateParams","$timeout","Winwin",function(a,b,c,d,e,f){a.getWinwin=function(){a.winwin=f.get({id:d.winwinId},function(b){a.title=b.title,e(function(){c.go("main")},1e3)})},a.getWinwin()}]).controller("winwin-joined",["$scope","$http","$state","$stateParams","$timeout","Winwin",function(a,b,c,d,e,f){a.getWinwin=function(){a.winwin=f.get({id:d.winwinId},function(b){a.title=b.title,e(function(){c.go("winwin-promote",{winwinId:d.winwinId})},1e3)})},a.getWinwin()}]).controller("winwin-sponsored",["$scope","$http","$state","$stateParams","$timeout","Winwin",function(a,b,c,d,e,f){a.getWinwin=function(){a.winwin=f.get({id:d.winwinId},function(b){a.title=b.title,e(function(){c.go("winwin-view",{winwinId:d.winwinId})},1e3)})},a.getWinwin()}]).controller("winwin-edit",["$scope","$state","$auth","$timeout","Upload","Winwin","Interest","api_host",function(a,b,c,d,e,f,g,h){a.winwin=new f({}),a.interests=[],a.scopes=["GLOBAL","REGION","COUNTRY","STATE","CITY"],a.first_stage=!0,a.second_stage=!1,a.winwin.closing_date=new Date,a.setup_components=function(){jQuery('[data-toggle="popover"]').popover(),jQuery('[data-toggle="tooltip"]').tooltip(),jQuery(".datepicker").pickadate({selectMonths:!0,selectYears:15}),jQuery("input#input_text, textarea#textarea1").characterCounter(),jQuery("input#input_text, textarea#textarea2").characterCounter(),jQuery(".modal-trigger").leanModal()},d(function(){a.setup_components()},1e3),g.query(function(b){a.interests=b}),a.doValidateBasic=function(){return!0},a.doValidateWinwin=function(){return a.winwin.gallery_image=a.image_gallery_selected,!a.saving},a.persistBasic=function(){a.doValidateBasic()&&(a.first_stage=!1,a.second_stage=!0,console.log("Second Stage: "+a.second_stage),$("html, body").animate({scrollTop:1},0))},a.doSave=function(){a.doValidateWinwin()&&(a.saving=!0,a.winwin.$save(function(c){b.go("winwin-first-post",{winwinId:a.winwin.id})}))},a.uploading=!1,a.uploadFiles=function(b){a.f=b,b&&!b.$error&&(b.upload=e.upload({url:h+"/api/winwins/upload",file:b}),b.upload.then(function(c){a.uploading=!1,d(function(){b.result=c.data,a.winwin.image=c.data.filename,a.preview_image="http://images.dev-winwins.net/smart/"+a.winwin.image})},function(b){a.uploading=!1,b.status>0&&(a.errorMsg=b.status+": "+b.data,swal({title:"Error",text:"Error al subir archivo",type:"warning",showCancelButton:!1,closeOnConfirm:!0}))}),b.upload.progress(function(c){a.uploading=!0,b.progress=Math.min(100,parseInt(100*c.loaded/c.total))})),"maxSize"==b.$error&&swal({title:"Error",text:"La imagen es demasiado grande",type:"warning",showCancelButton:!1,closeOnConfirm:!0})},a.matchYoutubeUrl=function(a){var b=/^(?:https?:\/\/)?(?:www\.)?(?:youtu\.be\/|youtube\.com\/(?:embed\/|v\/|watch\?v=|watch\?.+&v=))((\w|-){11})(?:\S+)?$/;return a.match(b)?RegExp.$1:!1},a.setVideoUrl=function(){swal({title:"Video Link",text:"Ingresa dirección de video:",type:"input",inputType:"url",showCancelButton:!0,closeOnConfirm:!0},function(b){if(b){var c=a.matchYoutubeUrl(b);c&&a.$apply(function(){a.winwin.video=c,a.preview_image="http://img.youtube.com/vi/"+c+"/default.jpg"})}})},a.gallery_picker=!1,a.select_gallery=function(){a.gallery_picker=!a.gallery_picker,a.image_gallery_selected||jQuery("#image-gallery").imagepicker({changed:function(b,c){a.image_gallery_selected=c,a.$apply(function(){a.gallery_picker=!1})}})},a.preview_image="",a.$watch("image_gallery_selected",function(){a.image_gallery_selected&&(a.preview_image="http://images.dev-winwins.net/smart/"+a.image_gallery_selected,a.$apply())})}]).controller("winwin-first-post",["$scope","$stateParams","$http","$state","$auth","$sce","$timeout","Winwin","Account","Upload","Post","api_host",function(a,b,c,d,e,f,g,h,i,j,k,l){a.ww_saved=!1,a.post=new k({}),a.profile={},a.winwin={},i.getProfile().success(function(b){b&&(a.profile=b.profile)}),h.get({id:b.winwinId},function(b){a.winwin=b,a.post.reference_id=b.id,a.post.type="WINWIN"}),a.submitPost=function(){a.post.$save(function(b){c.get(l+"/api/winwins/activate/"+a.winwin.id).success(function(b){d.go("winwin-promote",{winwinId:a.winwin.id})}).error(function(a){swal({title:"Error",text:"Error al enviar post",type:"warning",showCancelButton:!1,closeOnConfirm:!0})})})},a["continue"]=function(){d.go("winwin-view",{winwinId:a.winwin.id})},a.matchYoutubeUrl=function(a){var b=/^(?:https?:\/\/)?(?:www\.)?(?:youtu\.be\/|youtube\.com\/(?:embed\/|v\/|watch\?v=|watch\?.+&v=))((\w|-){11})(?:\S+)?$/;return a.match(b)?RegExp.$1:!1},a.setVideoUrl=function(){swal({title:"Video Link",text:"Ingresa dirección de video:",type:"input",inputType:"url",showCancelButton:!0,closeOnConfirm:!0},function(b){if(b){var c=a.matchYoutubeUrl(b);c?a.$apply(function(){a.post.media_type="VIDEO",a.post.media_path=c}):swal({title:"Incorrecto",text:"La direccion ingresada no es correcta",type:"warning"})}})},a.getIframeSrc=function(a){return f.trustAsResourceUrl("http://www.youtube.com/embed/"+a)},a.uploading=!1,a.uploadFiles=function(b){a.f=b,b&&!b.$error&&(console.log("enviando..."),b.upload=j.upload({url:l+"/api/posts/upload",file:b}),b.upload.then(function(c){console.log("success..."),a.uploading=!1,g(function(){b.result=c.data,a.post.media_id=c.data.media_id,a.post.media_type="IMAGE",a.post.media_path=c.data.filename})},function(b){console.log("error..."),a.uploading=!1,b.status>0&&(a.errorMsg=b.status+": "+b.data)}),b.upload.progress(function(c){console.log("progress..."),a.uploading=!0,b.progress=Math.min(100,parseInt(100*c.loaded/c.total))}))}}]).controller("winwin-promote",["$scope","$stateParams","$http","$state","$timeout","$uibModal","Winwin","Account",function(a,b,c,d,e,f,g,h){a.profile={},a.winwin={},h.getProfile().success(function(b){b&&(a.profile=b.profile)}),g.get({id:b.winwinId},function(b){a.winwin=b}),a.goView=function(){a.promote=!1,a.success=!0,e(function(){d.go("winwin-view",{winwinId:a.winwin.id})},1e3)},a.promote=!0,a.success=!1,a.openMailModal=function(b){a.toShare=b;f.open({animation:!1,windowTopClass:"modal-background",templateUrl:"myMailShare.html",controller:"ModalMailCtrl",resolve:{toShare:function(){return a.toShare},mails:function(){return{}}}})}}]).controller("winwin-list",["$scope","$http","$auth","$state","WinwinPaginate","api_host",function(a,b,c,d,e,f){a.winwins=new e,a.doFilter=function(a){console.log(a)},a.join=function(e){c.isAuthenticated()?b.get(f+"/api/winwins/join/"+e).success(function(b){swal({title:"info",text:"Te has unido al Winwin",type:"info",showcancelbutton:!1,animation:!1,closeonconfirm:!0}),a.view(e)}).error(function(a){swal({title:"ADVERTENCIA",text:"Error al unirse",type:"warning",showCancelButton:!1,closeOnConfirm:!0})}):d.go("signIn")},a.view=function(a){console.log("view "+a),d.go("winwin-view",{winwinId:a})}}]).controller("winwin-search",["$scope","$http","api_host",function(a,b,c){a.winwins=[],a.do_search=function(){b.get(c+"/api/winwins/search/",{params:{q:a.query}}).success(function(b){a.winwins=b}).error(function(a){})}}]).controller("winwin-members",["$scope","$http","$timeout","$stateParams","$state","Winwin","api_host",function(a,b,c,d,e,f,g){a.members_view=!0,a.current="all",c(function(){$(".grid-participantes").isotope({itemSelector:".participante-item",masonry:{columnWidth:380}})},1e3),a.classType=function(a){return(a.pivot.moderator?"activator":"")+" "+(a.pivot.creator?"creator":"")},a.filter=function(b){a.current=b,$(".grid-participantes").isotope({filter:"all"==b?"*":"."+b})},a.makeNormal=function(d){a.activated_name=d.username,b.post(g+"/api/winwins/"+a.winwin.id+"/state/normal/"+d.id).success(function(b){a.in_message=!0,a.normal_success=!0,c(function(){e.go("winwin-view",{winwinId:a.winwin.id},{reload:!0})},1e3)}).error(function(a){swal({title:"ADVERTENCIA",text:"Error al quitar privilegios",type:"warning",showCancelButton:!1,closeOnConfirm:!0})})},a.makeActivator=function(d){a.activated_name=d.username,b.post(g+"/api/winwins/"+a.winwin.id+"/state/activator/"+d.id).success(function(b){a.in_message=!0,a.activator_success=!0,c(function(){e.go("winwin-view",{winwinId:a.winwin.id},{reload:!0})},1e3)}).error(function(a){swal({title:"ADVERTENCIA",text:"Error al agregar privilegios",type:"warning",showCancelButton:!1,closeOnConfirm:!0})})},a.follow=function(a){b.get(g+"/api/users/follow/"+a.id).success(function(b){swal({title:"info",text:"Siguiendo!",type:"info",showcancelbutton:!1,animation:!1,closeonconfirm:!0}),a.following=!0,a.followers_amount=a.followers_amount+1}).error(function(a){swal({title:"ADVERTENCIA",text:"Error al seguir",type:"warning",showCancelButton:!1,closeOnConfirm:!0})})},a.view=function(a){e.go("user-view",{userId:a.id})},a.unfollow=function(a){b.get(g+"/api/users/unfollow/"+a.id).success(function(b){swal({title:"info",text:"Has dejado de seguir al usuario",type:"info",showcancelbutton:!1,animation:!1,closeonconfirm:!0}),a.following=!1,a.followers_amount=a.followers_amount-1}).error(function(a){swal({title:"ADVERTENCIA",text:"Error al dejar de seguir",type:"warning",showCancelButton:!1,closeOnConfirm:!0})})}}]).controller("winwin-sponsors",["$scope","$http","$timeout","$stateParams","Winwin","api_host",function(a,b,c,d,e,f){a.current="all",a.sponsors_view=!0,a.sponsors=[],a.getWinwin=function(){b.get(f+"/api/winwins/"+d.winwinId+"/sponsors").success(function(b){a.sponsors=_.filter(b,function(a){return 1==a.pivot.ww_accept&&1==a.pivot.sponsor_accept}),c(function(){$(".grid-sponsors").isotope({itemSelector:".sponsor-item",
masonry:{columnWidth:380}})},1e3)})},a.getWinwin(),a.classType=function(a){return a.pivot.promoted?"promoted":""},a.filter=function(b){a.current=b,$(".grid-sponsors").isotope({filter:"all"==b?"*":"."+b})},a.follow=function(a){b.get(f+"/api/sponsors/follow/"+a.id).success(function(b){swal({title:"info",text:"Siguiendo!",type:"info",showcancelbutton:!1,animation:!1,closeonconfirm:!0}),a.following=!0}).error(function(a){swal({title:"ADVERTENCIA",text:"Error al seguir",type:"warning",showCancelButton:!1,closeOnConfirm:!0})})},a.view=function(a){$state.go("sponsor-view",{userId:a.id})},a.unfollow=function(a){b.get(f+"/api/users/unfollow/"+a.id).success(function(b){swal({title:"info",text:"Has dejado de seguir al usuario",type:"info",showcancelbutton:!1,animation:!1,closeonconfirm:!0}),a.following=!1}).error(function(a){swal({title:"ADVERTENCIA",text:"Error al dejar de seguir",type:"warning",showCancelButton:!1,closeOnConfirm:!0})})}}]).controller("winwin-sponsors-to-request",["$scope","$http","$state","$timeout","$stateParams","Winwin","api_host",function(a,b,c,d,e,f,g){a.sponsors=[],a.getCandidates=function(){b.get(g+"/api/winwins/"+e.winwinId+"/sponsors/candidates").success(function(b){a.sponsors=b,d(function(){$(".grid-sponsors").isotope({itemSelector:".sponsor-item",masonry:{columnWidth:380}})},1e3)})},a.getCandidates(),a.view=function(a){c.go("sponsor-view",{userId:a.id})},a.request_success=!1,a.requestSponsor=function(e){a.sponsor_name=e.name,swal({title:"SOLICITAR PATROCINIO",text:"Envia un mensaje de solicitud al Sponsor",type:"input",showCancelButton:!0,closeOnConfirm:!0,inputPlaceholder:"Mensaje de solicitud"},function(f){return f===!1?!1:""===f?!1:(b.post(g+"/api/winwins/"+a.winwin.id+"/sponsor/request/"+e.id,{body:f}).success(function(b){a.request_success=!0,d(function(){c.go("winwin-view",{winwinId:a.winwin.id},{reload:!0})},1e3),c.go("winwin-sponsored",{winwinId:a.winwin.id,winwinName:a.winwin.title})}).error(function(a){swal({title:"Error",text:"Error al solicitar sponsoreo",type:"warning",showCancelButton:!1,closeOnConfirm:!0})}),!0)})}}]).controller("winwin-sponsors-requests",["$scope","$http","$state","$timeout","$stateParams","Winwin","api_host",function(a,b,c,d,e,f,g){a.sponsors=[],a.getRequests=function(){b.get(g+"/api/winwins/"+e.winwinId+"/sponsors").success(function(b){a.sponsors=_.filter(b,function(a){return 0==a.pivot.ww_accept&&1==a.pivot.sponsor_accept}),d(function(){$(".grid-sponsors").isotope({itemSelector:".sponsor-item",masonry:{columnWidth:380}})},1e3)})},a.getRequests(),a.view=function(a){c.go("sponsor-view",{userId:a.id})},a.accept_success=!1,a.acceptSponsor=function(e){a.sponsor_name=e.name,b.post(g+"/api/winwins/"+a.winwin.id+"/sponsor/"+e.id+"/accept").success(function(b){a.accept_success=!0,d(function(){c.go("winwin-view",{winwinId:a.winwin.id},{reload:!0})},1e3)}).error(function(a){swal({title:"ADVERTENCIA",text:a.message,type:"warning",showCancelButton:!1,closeOnConfirm:!0})})}}]).controller("winwin-muro",["$scope","$http","$auth","$stateParams","$sce","$timeout","$uibModal","Winwin","Account","Upload","Post","api_host",function(a,b,c,d,e,f,g,h,i,j,k,l){a.muro_view=!0,a.isAuthenticated=c.isAuthenticated(),a.winwin={},a.getWinwin=function(){console.log("Winwin fetch"),a.winwin=h.get({id:d.winwinId},function(b){a.winwin=b,a.polls=a.winwin.polls,a.loadPolls(),a.getPosts()})},a.loadPolls=function(){_.each(a.polls,function(a){b.get(l+"/api/polls/"+a.id).success(function(b){a.data=b,a.data.loaded=!0})})},a.selectAnswer=function(a,b){a.selected_answer=b.id},a.percentage_votes=function(a,b){if(!a.data.total_votes)return 0;var c=100*b.vote_count/a.data.total_votes;return c},a.votePoll=function(c){b.post(l+"/api/poll/"+c.id+"/vote/"+c.selected_answer,{positive:!0}).success(function(b){a.loadPolls()}).error(function(a){swal({title:"Error",text:a.message,type:"warning",showCancelButton:!1,closeOnConfirm:!0})})},a.getPosts=function(){console.log("get posts"),b.get(l+"/api/posts/winwin/"+d.winwinId+"/posts").success(function(b){a.posts=b.posts,a.last=b.last,a.post=new k({}),a.editing=!1})},a.getWinwin(),a.post=new k({}),a.profile={},a.isSponsor=!1,i.getProfile().success(function(b){b&&(a.profile=b.profile,a.isSponsor=b.sponsor)}),a.matchYoutubeUrl=function(a){var b=/^(?:https?:\/\/)?(?:www\.)?(?:youtu\.be\/|youtube\.com\/(?:embed\/|v\/|watch\?v=|watch\?.+&v=))((\w|-){11})(?:\S+)?$/;return a.match(b)?RegExp.$1:!1},a.setVideoUrl=function(){console.log("set video"),swal({title:"Video Link",text:"Ingresa dirección de video:",type:"input",inputType:"url",showCancelButton:!0,closeOnConfirm:!0},function(b){if(b){var c=a.matchYoutubeUrl(b);c?a.$apply(function(){a.post.media_type="VIDEO",a.post.media_path=c}):(console.log("Wrong url"),swal({title:"Incorrecto",text:"La direccion ingresada no es correcta",type:"warning"}))}})},a.getIframeSrc=function(a){return e.trustAsResourceUrl("http://www.youtube.com/embed/"+a)},a.uploading=!1,a.uploadFiles=function(b){a.post.media_type="IMAGE",a.f=b,console.log(b.$error),b&&!b.$error&&(a.uploading=!0,console.log("enviando..."),b.upload=j.upload({url:l+"/api/posts/upload",file:b}),b.upload.then(function(c){console.log("success..."),a.uploading=!1,f(function(){b.result=c.data,a.$apply(function(){a.post.media_id=c.data.media_id,a.post.media_type="IMAGE",a.post.media_path=c.data.filename})})},function(b){console.log("error..."),a.uploading=!1,b.status>0&&(a.errorMsg=b.status+": "+b.data)}),b.upload.progress(function(c){a.uploading=!0,console.log("progress..."),b.progress=Math.min(100,parseInt(100*c.loaded/c.total))}))},a.cancelEditing=function(){a.normal_size=!0,a.post=new k({}),a.editing=!1},a.sendingPost=!1,a.submitPost=function(){a.sendingPost||(a.sendingPost=!0,a.post.reference_id=a.winwin.id,a.post.type="WINWIN",a.post.$save(function(b){a.sendingPost=!1,swal({title:"Info",text:"Post enviado!",type:"info",showcancelbutton:!1,animation:!1,closeonconfirm:!0}),a.normal_size=!0,a.editing=!1,a.getPosts()},function(b){a.sendingPost=!1}))},a.normal_size=!0,a.editing=!1,a.min_size=function(){a.normal_size=!0},a.max_size=function(){a.normal_size=!1,a.editing=!0},a.vote=function(c,d){b.post(l+"/api/posts/"+c.id+"/vote",{positive:d}).success(function(b){a.getPosts()}).error(function(a){swal({title:"Error",text:a.message,type:"warning",showCancelButton:!1,closeOnConfirm:!0})})},a.reply=function(b){b.isReplying=!0,a.toShare=b;var c=g.open({animation:!1,windowTopClass:"modal-background",templateUrl:"commentModal.html",controller:"CommentCtrl",resolve:{post:function(){return b}}});c.result.then(function(b){a.getPosts()},function(){})},a.cancelReply=function(a){a.isReplying=!1},a.openSocialModal=function(b){a.toShare=b;g.open({animation:!1,windowTopClass:"modal-background",templateUrl:"postShareModal.html",controller:"ModalInstanceCtrl",resolve:{toShare:function(){return a.toShare}}})}}]).controller("CommentCtrl",["$scope","$uibModalInstance","$http","$sce","$timeout","api_host","post","Post","Upload",function(a,b,c,d,e,f,g,h,i){a.post=g,a.comment=new h({}),a.sendingPost=!1,a.submitComment=function(){a.sendingPost||c.post(f+"/api/posts/"+a.post.id+"/comment",{content:a.comment.content,media_id:a.comment.media_id,media_type:a.comment.media_type,media_path:a.comment.media_path}).success(function(c){a.sendingPost=!1,a.comment=new h({}),a.post=c,a.comment=new h({}),b.close(!0)}).error(function(b){a.sendingPost=!1,swal({title:"Error",text:b.message,type:"warning",showCancelButton:!1,closeOnConfirm:!0})})},a.matchYoutubeUrl=function(a){var b=/^(?:https?:\/\/)?(?:www\.)?(?:youtu\.be\/|youtube\.com\/(?:embed\/|v\/|watch\?v=|watch\?.+&v=))((\w|-){11})(?:\S+)?$/;return a.match(b)?RegExp.$1:!1},a.setVideoUrl=function(){console.log("set video"),swal({title:"Video Link",text:"Ingresa dirección de video:",type:"input",inputType:"url",showCancelButton:!0,closeOnConfirm:!0},function(b){if(b){var c=a.matchYoutubeUrl(b);c?a.$apply(function(){a.comment.media_type="VIDEO",a.comment.media_path=c}):(console.log("Wrong url"),swal({title:"Incorrecto",text:"La direccion ingresada no es correcta",type:"warning"}))}})},a.getIframeSrc=function(a){return d.trustAsResourceUrl("http://www.youtube.com/embed/"+a)},a.uploading=!1,a.uploadFiles=function(b){a.f=b,console.log(b.$error),b&&!b.$error&&(console.log("enviando..."),b.upload=i.upload({url:f+"/api/posts/upload",file:b}),b.upload.then(function(c){console.log("success..."),a.uploading=!1,e(function(){b.result=c.data,a.comment.media_id=c.data.media_id,a.comment.media_type="IMAGE",a.comment.media_path=c.data.filename})},function(b){console.log("error..."),a.uploading=!1,b.status>0&&(a.errorMsg=b.status+": "+b.data)}),b.upload.progress(function(c){a.uploading=!0,console.log("progress..."),b.progress=Math.min(100,parseInt(100*c.loaded/c.total))}))}}]).controller("winwin-campanada",["$scope","$http","$state","$stateParams","$timeout","Winwin","api_host",function(a,b,c,d,e,f,g){a.campanada_view=!0,a.campanada_success=!1,a.sentCampanada=function(){console.log("sent-campanada"),b.post("/api/winwins/campanada/"+a.winwin.id,{body:a.body}).success(function(b){a.campanada_success=!0,e(function(){c.go("winwin-view",{winwinId:a.winwin.id},{reload:!0})},1e3)}).error(function(a){swal({title:"Error",text:a.message,type:"warning",showCancelButton:!1,closeOnConfirm:!0})})}}]).controller("winwin-poll",["$scope","$http","$state","$stateParams","$timeout","Poll","api_host",function(a,b,c,d,e,f,g){a.poll_view=!0,a.poll_success=!1,a.poll={selected:1},a.submitPoll=function(){b.post("/api/winwins/"+a.winwin.id+"/poll",a.poll).success(function(b){a.poll_success=!0,e(function(){c.go("winwin-view",{winwinId:a.winwin.id},{reload:!0})},1e3)}).error(function(a){swal({title:"Error",text:a.message,type:"warning",showCancelButton:!1,closeOnConfirm:!0})})}}]).controller("winwin-miembros",["$scope","$http","$stateParams","Winwin",function(a,b,c,d){}]).controller("winwin-configuracion",["$scope","$http","$stateParams","Winwin",function(a,b,c,d){}]).controller("winwin-patrocinio",["$scope","$http","$stateParams","Winwin",function(a,b,c,d){}]).controller("winwin-sponsor-request",["$scope","$http","$state","$stateParams","Winwin",function(a,b,c,d,e){a.sentRequest=function(){b.post("/api/winwins/sponsor_request/"+a.winwin.id,{body:a.body}).success(function(b){swal({title:"Info",text:"Solicitud al sponsor enviada",type:"info",showcancelbutton:!1,animation:!1,closeonconfirm:!0}),c.go("winwin-view",{winwinId:a.winwin.id})}).error(function(a){swal({title:"Error",text:a.message,type:"warning",showCancelButton:!1,closeOnConfirm:!0})})}}]).controller("winwin-config",["$scope","$http","$state","$stateParams","api_host","Winwin",function(a,b,c,d,e,f){a.all_notifications=!1,a.toggleNotifications=function(){console.log("toggle"),a.all_notifications=!a.all_notifications,a.all_notifications&&(a.winwin.notification_user_post=!0,a.winwin.notification_new_participant=!0,a.winwin.notification_new_poll=!0,a.winwin.notification_announce=!0,a.winwin.notification_new_sponsor=!0,a.winwin.notification_closing_date=!0)},a.updateNotifications=function(){b.post(e+"/api/winwins/"+a.winwin.id+"/notifications",{notification_user_post:a.winwin.notification_user_post,notification_new_participant:a.winwin.notification_new_participant,notification_new:a.winwin.notification_new_poll,notification_announce:a.winwin.notification_announce,notification_new_sponsor:a.winwin.notification_new_sponsor,notification_closing_date:a.winwin.notification_closing_date}).success(function(a){swal({title:"Info",text:"Notificaciones actualizadas",type:"info",showcancelbutton:!1,animation:!1,closeonconfirm:!0})})},a.closeWinwin=function(){swal({title:"SOLICITAR BAJA WINWIN",text:"Contanos tus motivos",type:"input",showCancelButton:!0,closeOnConfirm:!0,inputPlaceholder:""},function(d){return d===!1?!1:""===d?!1:(b.post(e+"/api/winwins/"+a.winwin.id+"/close",{body:d}).success(function(a){swal({title:"Info",text:"Winwin cerrado",type:"info",showCancelButton:!1,closeOnConfirm:!0}),c.go("main")}).error(function(a){swal({title:"Error",text:a.message,type:"warning",showCancelButton:!1,closeOnConfirm:!0})}),!0)})}}]).controller("ModalMailCtrl",["$scope","$uibModalInstance","$http","$timeout","api_host","toShare","mails",function(a,b,c,d,e,f,g){a.toShare=f,a.success=!1,a.mails=[],a.current_mail="",a.addMail=function(){a.current_mail&&a.matchEmail(a.current_mail)&&(a.mails.push(a.current_mail),a.current_mail="")},a.removeMail=function(b){a.mails=_.without(a.mails,b)},a.sentInvitations=function(){c.post(e+"/api/winwins/"+a.toShare.id+"/share/mails",{mails:a.mails}).success(function(c){a.success=!0,d(function(){b.close()},2e3)})},a.matchEmail=function(a){var b=/^[a-zA-Z0-9_.+-]+@[a-zA-Z0-9-]+\.[a-zA-Z0-9-.]+$/;return a.match(b)}}]),angular.module("winwinsApp").controller("search-list",["$scope","$stateParams","$state","$http","$auth","api_host",function(a,b,c,d,e,f){console.dir(b),a.hits=[],a.winwins=[],a.users=[],a.sponsors=[],a.groups=[],d.get(f+"/api/ww/search/",{params:{q:b.query}}).success(function(b){a.hits=b,a.users=b.users||[],a.winwins=b.winwins||[],a.groups=b.groups||[],a.sponsors=b.sponsors||[]}).error(function(a){console.log(a)}),a.view=function(a,b){switch(console.log("Type: "+a+" - Id: "+b),a){case"winwins":c.go("winwin-view",{winwinId:b});break;case"users":c.go("user-view",{userId:b});break;default:c.go("winwin-view",{winwinId:b})}},a.join=function(b){e.isAuthenticated()?d.get(f+"/api/winwins/join/"+b).success(function(c){swal({title:"info",text:"winwin_join",type:"info",showcancelbutton:!1,animation:!1,closeonconfirm:!0}),a.view(b)}).error(function(a){swal({title:"ADVERTENCIA",text:a.message,type:"warning",showCancelButton:!1,closeOnConfirm:!0})}):c.go("signIn")}}]),angular.module("winwinsApp").controller("group-edit",["$scope","$state","$auth","$timeout","Upload","Group","Interest",function(a,b,c,d,e,f,g){a.group=new f({}),a.doValidate=function(){return a.group.gallery_image=a.image_gallery_selected,!0},a.first_stage=!0,a.second_stage=!1,a.doFirstStage=function(){a.first_stage=!1,a.second_stage=!0},a.doSave=function(){a.doValidate()&&a.group.$save(function(c){a.first_stage=!1,a.second_stage=!1,b.go("group-promote",{groupId:a.group.id})})},a.uploading=!1,a.uploadFiles=function(b){console.log("uploading"),a.f=b,b&&!b.$error&&(b.upload=e.upload({url:"/api/winwins/upload",file:b}),b.upload.then(function(c){a.uploading=!1,console.log("succeess"),d(function(){b.result=c.data,a.group.photo=c.data.filename,a.group.prephoto=c.data.filename,console.log(a.group.photo)})},function(b){console.log(b),a.uploading=!1,b.status>0&&(a.errorMsg=b.status+": "+b.data)}),b.upload.progress(function(c){a.uploading=!0,b.progress=Math.min(100,parseInt(100*c.loaded/c.total))}))},a.gallery_picker=!1,a.select_gallery=function(){a.gallery_picker=!0,a.image_gallery_selected||$("#image-gallery").imagepicker({changed:function(b,c){a.$apply(function(){a.gallery_picker=!1,console.log(c),a.group.prephoto=c[0]})}})}}]).controller("group-promote",["$scope","$state","$stateParams","$timeout","Group",function(a,b,c,d,e){a.group=new e({}),a.third_stage=!0,a.four_stage=!1,a.goToView=function(){a.third_stage=!1,a.four_stage=!0,d(function(){b.go("group-view",{groupId:a.group.id})},1e3)},a.getGroup=function(){a.group=e.get({id:c.groupId},function(a){})},a.getGroup()}]).controller("group-list",["$scope","$http","$auth","$state","GroupPaginate","api_host",function(a,b,c,d,e,f){a.groups=new e,a.doFilter=function(a){console.log(a)},a.join=function(e){c.isAuthenticated()?b.get(f+"/api/group/join/"+e).success(function(b){swal({title:"info",text:"group_join",type:"info",showcancelbutton:!1,animation:!1,closeonconfirm:!0}),a.view(winwin_id)}).error(function(a){swal({title:"ADVERTENCIA",text:a.message,type:"warning",showCancelButton:!1,closeOnConfirm:!0})}):d.go("signIn")},a.view=function(a){console.log("view "+a),d.go("group-view",{groupId:a})}}]).controller("group-view",["$scope","$http","$state","$stateParams","$timeout","$anchorScroll","$location","Group","Post","Account","api_host",function(a,b,c,d,e,f,g,h,i,j,k){a.edit_user={},a.is_admin=!1,a.current_view="home",a.isSponsor=!1,j.getProfile().success(function(b){b&&(a.account=b.account,a.profile=b.profile,a.sponsor=b.sponsor,a.isSponsor=b.is_sponsor)}),a.setCurrentView=function(b){a.current_view=b,a.is_admin="admin"==b},a.setNormal=function(){a.is_admin=!1},a.setAdmin=function(){a.user_detail.myself&&(a.is_admin=!0)},a.getGroup=function(){a.group=h.get({id:d.groupId},function(b){a.getThread(b.id)})},a.getGroup(),a.join=function(){b.get(k+"/api/groups/join/"+a.group.id).success(function(b){a.getGroup(),swal({title:"info",text:"group_join",type:"info",showcancelbutton:!1,closeonconfirm:!0})}).error(function(a){swal({title:"ADVERTENCIA",text:a.message,type:"warning",showCancelButton:!1,closeOnConfirm:!0})})},a.left=function(){b.get(k+"/api/groups/left/"+a.group.id).success(function(b){swal({title:"info",text:"group_left",type:"info",showcancelbutton:!1,closeonconfirm:!0}),a.getGroup()}).error(function(a){swal({title:"ADVERTENCIA",text:a.message,type:"warning",showCancelButton:!1,closeOnConfirm:!0})})},a.addToGroup=function(c){b.get(k+"/api/groups/"+a.group.id+"/add_winwin/"+c).success(function(b){swal({title:"info",text:"winwin_added_to_group",type:"info",showcancelbutton:!1,closeonconfirm:!0}),a.getGroup()}).error(function(a){swal({title:"ADVERTENCIA",text:a.message,type:"warning",showCancelButton:!1,closeOnConfirm:!0})})},a.removeFromGroup=function(c){b.get(k+"/api/groups/"+a.group.id+"/remove_winwin/"+c).success(function(b){swal({title:"info",text:"winwin_removed_from_group",type:"info",showcancelbutton:!1,closeonconfirm:!0}),a.getGroup()}).error(function(a){swal({title:"ADVERTENCIA",text:a.message,type:"warning",showCancelButton:!1,closeOnConfirm:!0})})},a.viewSponsor=function(a){c.go("sponsor-view",{sponsorId:a})},a.viewWinwin=function(a){c.go("winwin-view",{winwinId:a})},a.viewUser=function(a){c.go("user-view",{userId:a})},a.viewGroup=function(a){c.go("group-view",{groupId:a})},a.filter=function(b){a.current=b,$(".grid-participantes").isotope({filter:"all"==b?"*":"."+b})},e(function(){$(".grid-participantes").isotope({itemSelector:".participante-item",masonry:{columnWidth:380}})}),a.editing_conversation=!1,a.conversation=new i({}),a.newConversation=function(){a.editing_conversation=!0},a.cancelConversation=function(){a.editing_conversation=!1},a.newReply=function(a){a.editing_reply=!0},a.cancelReply=function(a){a.editing_reply=!1},a.submitConversation=function(){console.log("submit"),b.post(k+"/api/groups/"+a.group.id+"/conversation",{content:a.conversation.content,title:a.conversation.title}).success(function(b){a.comments=b,a.conversation=new i({}),a.editing_conversation=!1}).error(function(a){swal({title:"Error",text:a.message,type:"warning",showCancelButton:!1,closeOnConfirm:!0})})},a.reply=new i({}),a.submitReply=function(c){console.log("submit"),b.post(k+"/api/groups/"+a.group.id+"/conversation/"+c.id,{content:a.reply.content}).success(function(b){a.comments=b,a.reply=new i({}),c.editing_reply=!1}).error(function(a){swal({title:"Error",text:a.message,type:"warning",showCancelButton:!1,closeOnConfirm:!0})})},a.getThread=function(c){b.get(k+"/api/group_thread/"+c).success(function(b){a.comments=b})},a.follow=function(c){b.get(k+"/api/users/follow/"+c.id).success(function(b){a.getUser(),swal({title:"info",text:"user_follow",type:"info",showcancelbutton:!1,closeonconfirm:!0})}).error(function(a){swal({title:"ADVERTENCIA",text:a.message,type:"warning",showCancelButton:!1,closeOnConfirm:!0})})},a.unfollow=function(c){b.get(k+"/api/users/unfollow/"+c.id).success(function(b){swal({title:"info",text:"user_unfollow",type:"info",showcancelbutton:!1,closeonconfirm:!0}),a.getUser()}).error(function(a){swal({title:"ADVERTENCIA",text:a.message,type:"warning",showCancelButton:!1,closeOnConfirm:!0})})},a.askForSponsored=function(){swal({title:"SOLICITAR PATROCINIO",text:"Envia un mensaje de solicitud al administrador del Grupo",type:"input",showCancelButton:!0,closeOnConfirm:!0,inputPlaceholder:"Mensaje de solicitud"},function(d){return d===!1?!1:""===d?!1:(b.post("/api/groups/sponsor_request/"+a.group.id,{body:d}).success(function(b){c.go("group-sponsored",{groupId:a.group.id})}).error(function(a){swal({title:"Error",text:a.message,type:"warning",showCancelButton:!1,closeOnConfirm:!0})}),!0)})}}]).controller("group-sponsored",["$scope","$http","$state","$stateParams","$timeout","Group",function(a,b,c,d,e,f){a.getGroup=function(){a.group=f.get({id:d.groupId},function(b){a.name=b.name,e(function(){c.go("group-view",{groupId:d.groupId})},1e3)})},a.getGroup()}]).controller("group-config",["$scope","$state","$auth","$timeout","$http","Upload","Group","Interest","api_host",function(a,b,c,d,e,f,g,h,i){a.doValidate=function(){return a.group.gallery_image=a.image_gallery_selected,!0},a.doSave=function(){a.doValidate()&&e.post(i+"/api/group/"+a.group.id,a.group).success(function(c){swal({title:"info",text:"group_updated",type:"info",showcancelbutton:!1,closeonconfirm:!0}),b.go("group-view",{groupId:a.group.id})}).error(function(a){swal({title:"Error",text:a.message,type:"warning",showCancelButton:!1,closeOnConfirm:!0})})},a.uploading=!1,a.uploadFiles=function(b){console.log("uploading"),a.f=b,b&&!b.$error&&(b.upload=f.upload({url:"/api/winwins/upload",file:b}),b.upload.then(function(c){a.uploading=!1,console.log("succeess"),d(function(){b.result=c.data,a.group.photo=c.data.filename,console.log(a.group.photo)})},function(b){console.log(b),a.uploading=!1,b.status>0&&(a.errorMsg=b.status+": "+b.data)}),b.upload.progress(function(c){a.uploading=!0,b.progress=Math.min(100,parseInt(100*c.loaded/c.total))}))},a.gallery_picker=!1,a.select_gallery=function(){a.gallery_picker=!0,a.image_gallery_selected||$("#image-gallery").imagepicker({changed:function(b,c){c&&(a.group.photo=!1),a.$apply(function(){a.gallery_picker=!1})}})}}]),angular.module("winwinsApp").controller("sponsor-list",["$scope","$state","SponsorPaginate",function(a,b,c){a.sponsors=new c,a.view=function(a){b.go("sponsor-view",{sponsorId:a})}}]).controller("sponsor-view",["$scope","$http","$state","$stateParams","$timeout","$anchorScroll","$location","Sponsor","api_host","Upload",function(a,b,c,d,e,f,g,h,i,j){a.is_admin=!1,a.current_view="home",a.setCurrentView=function(b){a.current_view=b,a.is_admin="admin"==b},a.setNormal=function(){a.is_admin=!1},a.setAdmin=function(){a.user_detail.myself&&(a.is_admin=!0)},a.edit_sponsor={},a.getSponsor=function(){a.sponsor=h.get({id:d.sponsorId},function(b){a.sponsor=b,a.edit_sponsor=b})},a.getSponsor(),a.follow=function(){b.get(i+"/api/sponsors/follow/"+a.sponsor.id).success(function(b){a.getSponsor(),swal({title:"info",text:"sponsor_join",type:"info",showcancelbutton:!1,animation:!1,closeonconfirm:!0})}).error(function(a){swal({title:"ADVERTENCIA",text:a.message,type:"warning",showCancelButton:!1,animation:!1,closeOnConfirm:!0})})},a.unfollow=function(){b.get(i+"/api/sponsors/unfollow/"+a.sponsor.id).success(function(b){swal({title:"info",text:"sponsor_left",type:"info",showcancelbutton:!1,animation:!1,closeonconfirm:!0}),a.getSponsor()}).error(function(a){swal({title:"ADVERTENCIA",text:a.message,type:"warning",showCancelButton:!1,closeOnConfirm:!0})})},a.uploading=!1,a.uploadFiles=function(b){a.f=b,b&&!b.$error&&(b.upload=j.upload({url:i+"/api/sponsor/upload",file:b}),b.upload.then(function(c){a.uploading=!1,e(function(){b.result=c.data,a.edit_sponsor.photo=c.data.filename})},function(b){a.uploading=!1,b.status>0&&(a.errorMsg=b.status+": "+b.data)}),b.upload.progress(function(c){a.uploading=!0,b.progress=Math.min(100,parseInt(100*c.loaded/c.total))}))},a.uploading_cover=!1,a.uploadFilesCover=function(b){a.fc=b,b&&!b.$error&&(b.upload=j.upload({url:i+"/api/sponsor/upload",file:b}),b.upload.then(function(c){a.uploading_cover=!1,e(function(){b.result=c.data,a.edit_sponsor.cover_photo=c.data.filename})},function(b){a.uploading_cover=!1,b.status>0&&(a.errorMsgCover=b.status+": "+b.data)}),b.upload.progress(function(c){a.uploading_cover=!0,b.progress=Math.min(100,parseInt(100*c.loaded/c.total))}))},a.saveProfile=function(){b.post(i+"/api/sponsor/profile",a.edit_sponsor).success(function(b){a.getSponsor(),swal({title:"info",text:"Los datos fueron actualizados",type:"info",showcancelbutton:!1,animation:!1,closeonconfirm:!0})}).error(function(a){swal({title:"Error",text:a.message,type:"warning",showCancelButton:!1,closeOnConfirm:!0})})}}]),angular.module("winwinsApp").controller("user-list",["$scope","$state","$http","$auth","UserPaginate","api_host",function(a,b,c,d,e,f){a.users=new e,a.isAuthenticated=function(){return d.isAuthenticated()},a.view=function(a){b.go("user-view",{userId:a})},a.follow=function(b){c.get(f+"/api/users/follow/"+b).success(function(b){a.getUser(),swal({title:"info",text:"Siguiendo!",type:"info",showcancelbutton:!1,closeonconfirm:!0})}).error(function(a){swal({title:"ADVERTENCIA",text:a.message,type:"warning",showCancelButton:!1,animation:!1,closeOnConfirm:!0})})}}]).controller("user-view",["$scope","$http","$state","$stateParams","$timeout","$anchorScroll","$location","$rootScope","User","Post","api_host",function(a,b,c,d,e,f,g,h,i,j,k){a.comments=[],a.followers=[],a.following=[],a.getUser=function(){console.log("User id profile: "+d.userId),a.user=i.get({id:d.userId},function(b){a.user_detail=b,a.comments=b.comments,a.notifications=b.notifications,a.followers=b.followers,a.following=b.following})},a.getUser(),a.follow=function(){b.get(k+"/api/users/follow/"+a.user.id).success(function(b){a.getUser(),swal({title:"info",text:"Siguiendo!",type:"info",showcancelbutton:!1,closeonconfirm:!0})}).error(function(a){swal({title:"ADVERTENCIA",text:a.message,type:"warning",showCancelButton:!1,animation:!1,closeOnConfirm:!0})})},a.unfollow=function(){b.get(k+"/api/users/unfollow/"+a.user.id).success(function(b){swal({title:"info",text:"Dejaste de seguir al usuario",type:"info",showcancelbutton:!1,closeonconfirm:!0}),a.getUser()}).error(function(a){swal({title:"ADVERTENCIA",text:a.message,type:"warning",showCancelButton:!1,animation:!1,closeOnConfirm:!0})})},a.comment=new j({}),a.submitComment=function(){console.log("submit"),b.post(k+"/api/users/"+a.user.id+"/comment",{content:a.comment.content}).success(function(b){a.comments=b,a.comment=new j({})}).error(function(a){swal({title:"Error",text:a.message,type:"warning",showCancelButton:!1,animation:!1,closeOnConfirm:!0})})},a.filter=function(b){a.current=b,$(".grid-participantes").isotope({filter:"all"==b?"*":"."+b})},e(function(){$(".grid-participantes").isotope({itemSelector:".participante-item",masonry:{columnWidth:380}})}),a.view=function(a){c.go("user-view",{userId:a})},a.viewWinwin=function(a){c.go("winwin-view",{winwinId:a})},a.viewUser=function(a){c.go("user-view",{userId:a})},a.viewGroup=function(a){c.go("group-view",{groupId:a})}}]).controller("ProfileCtrl",["$rootScope","$scope","$http","$state","$stateParams","$timeout","$anchorScroll","$location","$auth","Upload","User","Account","api_host",function(a,b,c,d,e,f,g,h,i,j,k,l,m){b.followers=[],b.following=[],b.comments=[],b.notifications=[],b.is_admin=!1,b.edit_user={},b.current_view="home",b.setCurrentView=function(a){b.current_view=a,b.is_admin="admin"==a},b.setNormal=function(){b.is_admin=!1},b.setAdmin=function(){b.user_detail.myself&&(b.is_admin=!0)},b.getUser=function(){l.getProfile().then(function(a){b.account=a.data,k.get({id:b.account.user.id},function(a){b.user_detail=a,b.followers=a.followers,b.following=a.following,b.comments=a.comments,b.notifications=a.notifications,b.edit_user=a,b.setup_components()})})},b.getUser(),b.follow=function(a){c.get(m+"/api/users/follow/"+a).success(function(a){b.getUser(),swal({title:"info",text:"Siguiendo!",type:"info",showcancelbutton:!1,closeonconfirm:!0})}).error(function(a){swal({title:"ADVERTENCIA",text:a.message,type:"warning",showCancelButton:!1,animation:!1,closeOnConfirm:!0})})},b.unfollow=function(a){c.get(m+"/api/users/unfollow/"+a).success(function(a){swal({title:"info",text:"Dejaste de seguir al usuario",type:"info",showcancelbutton:!1,closeonconfirm:!0}),b.getUser()}).error(function(a){swal({title:"ADVERTENCIA",text:a.message,type:"warning",showCancelButton:!1,animation:!1,closeOnConfirm:!0})})},b.filter=function(a){b.current=a,b.isot.isotope({filter:"all"==a?"*":"."+a})},b.view=function(a){d.go("user-view",{userId:a})},b.viewWinwin=function(a){d.go("winwin-view",{winwinId:a})},b.viewUser=function(a){console.log("view user: "+a),d.go("user-view",{userId:a})},b.viewGroup=function(a){d.go("group-view",{groupId:a})},b.$watch("following",function(){b.following.length>0&&f(function(){b.isot=angular.element(".grid-participantes"),b.isot.isotope({itemSelector:".participante-item",masonry:{columnWidth:380}})})}),b.$watch("followers",function(){b.followers.length>0&&f(function(){b.isot=angular.element(".grid-participantes"),b.isot.isotope({itemSelector:".participante-item",masonry:{columnWidth:380}})})}),b.setup_components=function(){$("#datetimepicker1").datetimepicker({maxDate:new Date,format:"DD - MM - YYYY"}),console.log(b.edit_user.birthdate)},b.uploading=!1,b.uploadFiles=function(a){b.f=a,a&&!a.$error&&(b.uploading=!0,a.upload=j.upload({url:"/api/me/upload",file:a}),a.upload.then(function(c){b.uploading=!1,f(function(){a.result=c.data,b.edit_user.photo=c.data.filename})},function(a){b.uploading=!1,a.status>0&&(b.errorMsg=a.status+": "+a.data)}),a.upload.progress(function(c){b.uploading=!0,a.progress=Math.min(100,parseInt(100*c.loaded/c.total))}))},b.uploadFilesCover=function(a){b.fc=a,a&&!a.$error&&(b.uploading=!0,a.upload=j.upload({url:"/api/me/upload",file:a}),a.upload.then(function(c){b.uploading=!1,f(function(){a.result=c.data,b.edit_user.cover_photo=c.data.filename})},function(a){b.uploading=!1,a.status>0&&(b.errorMsgCover=a.status+": "+a.data)}),a.upload.progress(function(c){b.uploading=!0,a.progress=Math.min(100,parseInt(100*c.loaded/c.total))}))},b.saveProfile=function(){c.post(m+"/api/profile",b.edit_user).success(function(c){b.getUser(),swal({title:"info",text:"Datos actualizados!",type:"info",showcancelbutton:!1,closeonconfirm:!0}),a.profile_photo=b.edit_user.photo}).error(function(a){swal({title:"Error",text:a.message,type:"warning",showCancelButton:!1,animation:!1,closeOnConfirm:!0})})},b.setOption=function(a,c){b.edit_user[a]=c,console.log("Key: "+a+" - value: "+c),console.log("user_edit: "+b.edit_user[a])},b.cancelAccount=function(){swal({title:"Cancelar Mi Cuenta",text:"Contanos tus motivos",type:"input",showCancelButton:!0,animation:!1,closeOnConfirm:!0,inputPlaceholder:"Mensaje de solicitud"},function(a){return c.post("/api/me/cancel",{body:a}).success(function(a){d.go("cancel-account")}).error(function(a){swal({title:"Error",text:a.message,type:"warning",showCancelButton:!1,animation:!1,closeOnConfirm:!0})}),!0})}}]).controller("cancel-account",["$scope","$rootScope","$state","$stateParams","$timeout","$auth",function(a,b,c,d,e,f){e(function(){f.logout().then(function(){b.$broadcast("is_logged",!1)})},1e3)}]).controller("ProfileNotificaciones",["$scope","$http","$state","$stateParams","$timeout","$anchorScroll","$location","User","Account","api_host",function(a,b,c,d,e,f,g,h,i,j){a.getUser=function(){i.getProfile().then(function(b){a.account=b.data,h.get({id:a.account.user.id},function(b){a.user_detail=b})}),b.get(j+"/api/me/notificactions/read").success(function(a){})},a.getUser()}]),angular.module("winwinsApp").controller("LoginCtrl",["$scope","$rootScope","$auth","$state","$timeout",function(a,b,c,d,e){a.show_login=!0,a.redirect_message=!1,a.login=function(){c.login({email:a.email,password:a.password}).then(function(c){b.currentUser=c,b.$broadcast("is_logged",!0),a.show_login=!1,a.redirect_message=!0,e(function(){if(b.returnState)switch(b.returnState.state){case"ww-join":var a=b.returnState.parameters.winwinId;b.returnState=null,d.go("winwin-view",{winwinId:a,actionJoin:!0});break;default:d.go("main")}else d.go("main")},3e3)})["catch"](function(a){
swal({title:"ADVERTENCIA",text:"El usuario y/o password son incorrectos",type:"warning",showCancelButton:!1,animation:!1,closeOnConfirm:!0}),d.go("signIn")})},a.authenticate=function(f){c.authenticate(f).then(function(c){b.currentUser=c,b.$broadcast("is_logged",!0),a.show_login=!1,a.provider=f,a.redirect_message=!0,e(function(){if(b.returnState)switch(b.returnState.state){case"ww-join":var a=b.returnState.parameters.winwinId;b.returnState=null,d.go("winwin-view",{winwinId:a,actionJoin:!0});break;default:d.go("main")}else d.go("main")},3e3)})["catch"](function(a){swal({title:"ADVERTENCIA",text:"Error en la autenticación con la red social",type:"warning",showCancelButton:!1,animation:!1,closeOnConfirm:!0}),d.go("signin")})},a.goSignup=function(){d.go("signUp")}}]).controller("FailureLogin",["$scope","$state","$timeout",function(a,b,c){}]).controller("SuccessLogin",["$scope","$state","$timeout",function(a,b,c){c(function(){b.go("main")},1e3)}]),angular.module("winwinsApp").controller("LogoutCtrl",["$auth","$rootScope","$state",function(a,b,c){a.isAuthenticated()&&a.logout().then(function(){b.$broadcast("is_logged",!1),c.go("main")})}]),angular.module("winwinsApp").controller("MembersCtrl",["$scope","$animate",function(a,b){}]),angular.module("winwinsApp").controller("NavController",["$scope","$rootScope","$state","$location","$timeout","$auth","$window","Account",function(a,b,c,d,e,f,g,h){a.unreadNotifications=0,a.profile=!1,a.is_logged=!1,a.isSponsor=!1,a.sponsor=!1,a.$on("$stateChangeStart",function(){f.isAuthenticated()?h.getStatus().then(function(b){console.log("get status"),a.unreadNotifications=b.data.notifications_unread}):a.unreadNotifications=0}),b.$on("is_logged",function(c,d){a.is_logged=d,console.log("is logged? "+d),d?a.fetching_profile||a.profile||(a.fetching_profile=!0,h.getProfile().then(function(c){a.fetching_profile=!1,a.profile=c.data.profile,a.sponsor=c.sponsor,a.isSponsor=c.is_sponsor,b.account=a.profile,console.log("Fetching profile"),b.profile_photo=a.profile.photo,console.log(b.profile_photo)})):(b.profile_photo=!1,a.profile=!1,a.is_logged=!1,a.sponsor=!1,a.isSponsor=!1,b.account={})}),b.$on("$stateChangeSuccess",function(a,b){jQuery(".button-collapse").sideNav("hide"),jQuery("html, body").animate({scrollTop:1},0)}),a.isAuthenticated=function(){var c=f.isAuthenticated();return a.fetching_profile||a.profile||!c||(a.fetching_profile=!0,console.log("is Authenticated"),h.getProfile().then(function(c){a.fetching_profile=!1,a.profile=c.data.profile,a.sponsor=c.data.sponsor,a.isSponsor=c.data.is_sponsor,b.profile_photo=a.profile.photo,b.$broadcast("is_logged",!0)})),c},a.fetching_profile=!1,a.getProfile=function(){return a.profile},a.do_back=function(){g.history.back()},a.goProfile=function(){console.log("go profile"),console.log("is sponsor? "+a.isSponsor),a.isSponsor?c.go("sponsor-view",{sponsorId:a.sponsor.id}):c.go("profile")},a.goNotifications=function(){c.go("profile_notificaciones")},e(function(){jQuery(".button-collapse").sideNav()})}]),angular.module("birth-day",["ng"]).directive("birthDayPicker",function(){return{restrict:"A",replace:!0,required:"birthday",scope:{birthday:"=",onChange:"&"},template:'<div class="birthday-picker input-group"><input type="number" placeholder="Día" id="monthDay" ng-model="birthDay" min="1" max="31" max-lengh="2" ng-change="birthpickerchanged();" class="birth-day form-control col-xs-4 col-md-4 no-padding"/><select ng-model="birthMonth" ng-change="birthpickerchanged();" class="birth-month  form-control col-xs-4 col-md-4 no-padding"><option value="1">Enero</option><option value="2">Febrero</option><option value="3">Marzo</option><option value="4">Abril</option><option value="5">Mayo</option><option value="6">Junio</option><option value="7">Julio</option><option value="8">Agosto</option><option value="9">Septiembre</option><option value="10">Octubre</option><option value="11">Noviembre</option><option value="12">Diciembre</option></select><input type="number" placeholder="Año" id="Year" ng-model="birthYear" min="1900" max-lengh="4"  max="{{maxyear();}}" ng-change="birthpickerchanged();" class="birth-year form-control col-xs-4 col-md-4 no-padding" name="birth"/></div>',link:function(a,b,c){if(null==a.birthday)a.birthMonth=(new Date).getMonth(),a.birthDay=(new Date).getDate(),a.birthYear=(new Date).getFullYear();else{var d=new Date(a.birthday);a.birthMonth=d.getMonth()+1,a.birthDay=d.getDate(),a.birthYear=d.getFullYear()}a.birthpickerchanged=function(){a.birthDay>31?a.birthDay=31:a.birthDay<=0?a.birthDay=1:void 0==a.birthDay&&(a.birthDay=31),a.birthDay>a.maxyear()&&(a.birthDay=a.maxyear());var b=new Date(a.birthYear,a.birthMonth-1,a.birthDay,0,0,0);a.birthday=b,a.onChange({data:a.birthday})},a.maxyear=function(){return(new Date).getFullYear()}}}}),angular.module("winwinsApp").directive("ensureUnique",["$http",function(a){return{require:"ngModel",link:function(a,b,c,d){a.$watch(c.ngModel,function(){})}}}]).directive("compareTo",[function(){return{require:"ngModel",scope:{otherModelValue:"=compareTo"},link:function(a,b,c,d){d.$validators.compareTo=function(b){return b==a.otherModelValue},a.$watch("otherModelValue",function(){d.$validate()})}}}]),angular.module("winwinsApp").directive("searchBar",["$animate","$state",function(a,b){return{restrict:"E",replace:!0,scope:{},templateUrl:"views/extras/searchBar.html",link:function(a,c,d,e){a.searchActive=!1,a.toggleSearchBar=function(){a.searchActive=!a.searchActive,a.searchActive},a.search=function(){console.dir($("#query").val()),b.go("search-list",{query:$("#query").val(),winwin:$("#search_winwin").val(),user:$("#search_user").val(),group:$("#search_group").val(),sponsor:$("#search_sponsor").val()})}}}}]),angular.module("winwinsApp").directive("ngTranslateLanguageSelect",["LocaleService",function(a){"use strict";return{restrict:"A",replace:!0,template:'<div class="dropdown language-select" ng-if="visible"><select ng-model="currentLocaleDisplayName"ng-options="localesDisplayName for localesDisplayName in localesDisplayNames"ng-change="changeLanguage(currentLocaleDisplayName)"></select></div>',controller:["$scope",function(b){b.currentLocaleDisplayName=a.getLocaleDisplayName(),b.localesDisplayNames=a.getLocalesDisplayNames(),b.visible=b.localesDisplayNames&&b.localesDisplayNames.length>1,b.changeLanguage=function(b){a.setLocaleByDisplayName(b)}}]}}]),angular.module("truncate",[]).filter("characters",function(){return function(a,b,c){if(isNaN(b))return a;if(0>=b)return"";if(a&&a.length>b){if(a=a.substring(0,b),c)for(;" "===a.charAt(a.length-1);)a=a.substr(0,a.length-1);else{var d=a.lastIndexOf(" ");-1!==d&&(a=a.substr(0,d))}return a+"…"}return a}}).filter("splitcharacters",function(){return function(a,b){if(isNaN(b))return a;if(0>=b)return"";if(a&&a.length>b){var c=a.substring(0,b/2),d=a.substring(a.length-b/2,a.length);return c+"..."+d}return a}}).filter("words",function(){return function(a,b){if(isNaN(b))return a;if(0>=b)return"";if(a){var c=a.split(/\s+/);c.length>b&&(a=c.slice(0,b).join(" ")+"…")}return a}}),angular.module("truncate",[]).filter("moment",function(){return function(a,b){return moment(a).format(b)}}),angular.module("winwinsApp").factory("Group",["$resource","api_host",function(a,b){return a(b+"/api/groups/:id",{id:"@id"},{update:{method:"POST"}})}]).factory("Poll",["$resource","api_host",function(a,b){return a(b+"/api/polls/:id",{id:"@id"},{update:{method:"POST"}})}]).factory("Sponsor",["$resource","api_host",function(a,b){return a(b+"/api/sponsors/:id",{id:"@id"},{update:{method:"POST"}})}]).factory("Story",["$resource","api_host",function(a,b){return a(b+"/api/stories/:id",{id:"@id"},{update:{method:"POST"}})}]).factory("Account",["$http","api_host",function(a,b){return{getProfile:function(){return console.log("get profile"),a.get(b+"/api/me")},getStatus:function(){return a.get(b+"/api/me/status")},updateProfile:function(c){return a.put(b+"/api/me",c)}}}]).factory("User",["$resource","api_host",function(a,b){return a(b+"/api/users/:id",{id:"@id"},{update:{method:"POST"}})}]).factory("Winwin",["$resource","api_host",function(a,b){return a(b+"/api/winwins/:id",{id:"@id"},{update:{method:"POST"}})}]).factory("Post",["$resource","api_host",function(a,b){return a(b+"/api/posts/:id",{id:"@id"},{update:{method:"POST"}})}]).factory("Comment",["$resource","api_host",function(a,b){return a(b+"/api/comments/:id",{id:"@id"},{update:{method:"POST"}})}]).factory("ActivityType",["$resource","api_host",function(a,b){return a(b+"/api/parametric/activities/:id",{id:"@id"},{update:{method:"POST"}})}]).factory("Interest",["$resource","api_host",function(a,b){return a(b+"/api/parametric/interests/:id",{id:"@id"},{update:{method:"POST"}})}]).factory("Marital",["$resource","api_host",function(a,b){return a(b+"/api/parametric/marital/:id",{id:"@id"},{update:{method:"POST"}})}]).factory("Language",["$resource","api_host",function(a,b){return a(b+"/api/parametric/languages/:id",{id:"@id"},{update:{method:"POST"}})}]).factory("TokenService",["$http","api_host",function(a,b){function c(){return a.get(b+"/auth/token").then(d,e)}function d(a){return a}function e(a){return a}return{get:c}}]).factory("WinwinPaginate",["$http","api_host",function(a,b){var c=function(){this.items=[],this.busy=!1,this.current_page=0};return c.prototype.nextPage=function(){if(!this.busy){this.busy=!0;var c=this;a.get(b+"/api/winwins/paginate/"+(this.current_page||"0")+"/15").success(function(a){c.current_page=c.current_page+1;for(var b=0;b<a.length;b++)c.items.push(a[b]);c.busy=!1})}},c}]).factory("GroupPaginate",["$http","api_host",function(a,b){var c=function(){this.items=[],this.busy=!1,this.current_page=0};return c.prototype.nextPage=function(){if(!this.busy){this.busy=!0;var c=this;a.get(b+"/api/groups/paginate/"+(this.current_page||"0")+"/15").success(function(a){c.current_page=c.current_page+1;for(var b=0;b<a.length;b++)c.items.push(a[b]);c.busy=!1})}},c}]).factory("UserPaginate",["$http","api_host",function(a,b){var c=function(){this.items=[],this.busy=!1,this.current_page=0};return c.prototype.nextPage=function(){if(!this.busy){this.busy=!0;var c=this;a.get(b+"/api/users/paginate/"+(this.current_page||"0")+"/15").success(function(a){c.current_page=c.current_page+1;for(var b=0;b<a.length;b++)c.items.push(a[b]);c.busy=!1})}},c}]).factory("SponsorPaginate",["$http","api_host",function(a,b){var c=function(){this.items=[],this.busy=!1,this.current_page=0};return c.prototype.nextPage=function(){if(!this.busy){this.busy=!0;var c=this;a.get(b+"/api/sponsors/paginate/"+(this.current_page||"0")+"/15").success(function(a){c.current_page=c.current_page+1;for(var b=0;b<a.length;b++)c.items.push(a[b]);c.busy=!1})}},c}]),angular.module("winwinsApp").service("LocaleService",["$translate","LOCALES","$rootScope","tmhDynamicLocale",function(a,b,c,d){"use strict";var e=b.locales,f=Object.keys(e);f&&0!==f.length||console.error("There are no _LOCALES provided");var g=[];f.forEach(function(a){g.push(e[a])});var h=a.proposedLanguage(),i=function(a){return-1!==f.indexOf(a)},j=function(b){return i(b)?(h=b,void a.use(b)):void console.error('Locale name "'+b+'" is invalid')};return c.$on("$translateChangeSuccess",function(a,b){document.documentElement.setAttribute("lang",b.language),d.set(b.language.toLowerCase().replace(/_/g,"-"))}),{getLocaleDisplayName:function(){return e[h]},setLocaleByDisplayName:function(a){j(f[g.indexOf(a)])},getLocalesDisplayNames:function(){return g}}}]);